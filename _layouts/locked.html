<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§å¯†ç¬”è®°</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif; background: #f2f2f7; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; color: #333; }
        .card { background: white; padding: 2.5rem; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.08); width: 100%; max-width: 380px; text-align: center; }
        h2 { margin-top: 0; font-weight: 700; color: #1d1d1f; }
        p { color: #86868b; margin-bottom: 2rem; font-size: 0.95rem; }
        input { width: 100%; padding: 15px; border: 1px solid #d2d2d7; border-radius: 12px; font-size: 16px; margin-bottom: 15px; outline: none; box-sizing: border-box; transition: all 0.2s; }
        input:focus { border-color: #0071e3; box-shadow: 0 0 0 4px rgba(0,113,227,0.1); }
        button { width: 100%; padding: 15px; background: #0071e3; color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: background 0.2s; }
        button:hover { background: #0077ed; }
        .error { color: #ff3b30; font-size: 14px; margin-top: 15px; display: none; background: #fff2f2; padding: 10px; border-radius: 8px; }
        #content { display: none; margin-top: 20px; text-align: left; line-height: 1.6; word-wrap: break-word; color: #1d1d1f; }
    </style>
</head>
<body>

<div class="card" id="loginBox">
    <h2>ğŸ” å—é™å†…å®¹</h2>
    <p>è¯·è¾“å…¥å¯†é’¥ä»¥è§£é”æŸ¥çœ‹</p>
    
    <input type="password" id="password" placeholder="è¯·è¾“å…¥è®¿é—®å¯†é’¥" autofocus>
    <button onclick="unlock()">è§£ é”</button>
    
    <div id="errorMsg" class="error"></div>
</div>

<div id="content" class="card" style="max-width: 800px; display: none;">
    </div>

<input type="hidden" id="iv-config" value="00000000000000000000000000000000">

<input type="hidden" id="ciphertext-config" value="{{ content }}">

<script>
    function unlock() {
        // 1. è·å–è¾“å…¥ï¼Œå¹¶å»é™¤å¯èƒ½å­˜åœ¨çš„é¦–å°¾ç©ºæ ¼
        const password = document.getElementById('password').value.trim();
        const ivStr = document.getElementById('iv-config').value; // ä¸åšä»»ä½•ä¿®æ”¹ï¼ŒåŸæ ·è·å–
        const ciphertext = document.getElementById('ciphertext-config').value.trim();
        
        const errorEl = document.getElementById('errorMsg');
        errorEl.style.display = 'none';

        if (!password) {
            errorEl.innerText = "è¯·è¾“å…¥å¯†é’¥";
            errorEl.style.display = 'block';
            return;
        }

        try {
            // --- æ ¸å¿ƒé€»è¾‘ï¼šå®Œå…¨å¤åˆ»åŒæ¨¡ç‰ˆä¸­çš„ Text æ¨¡å¼ ---
            
            // 1. è§£æ Key (UTF-8)
            const key = CryptoJS.enc.Utf8.parse(password);

            // 2. è§£æ IV (UTF-8)
            // å…³é”®ç‚¹ï¼šä¸åš substring æˆªæ–­ï¼
            // æ—¢ç„¶ä¹‹å‰ 32 ä¸ªå­—ç¬¦çš„ Text æ¨¡å¼æˆåŠŸäº†ï¼Œæˆ‘ä»¬å°±æŠŠè¿™ 32 ä¸ªå­—ç¬¦å®Œæ•´å–‚ç»™ CryptoJS
            // è®©åº“è‡ªå·±å»å¤„ç†åº•å±‚çš„å­—èŠ‚å¯¹é½
            const iv = CryptoJS.enc.Utf8.parse(ivStr);

            // 3. è§£å¯†
            const decrypted = CryptoJS.AES.decrypt(ciphertext, key, {
                iv: iv,
                mode: CryptoJS.mode.CBC,
                padding: CryptoJS.pad.Pkcs7
            });

            const result = decrypted.toString(CryptoJS.enc.Utf8);

            if (result && result.length > 0) {
                // æˆåŠŸï¼
                document.getElementById('loginBox').style.display = 'none';
                document.getElementById('content').innerHTML = result;
                document.getElementById('content').style.display = 'block';
            } else {
                throw new Error("Padding Check Failed");
            }

        } catch (e) {
            console.error(e);
            errorEl.innerText = "è§£å¯†å¤±è´¥ï¼šå¯†é’¥é”™è¯¯";
            errorEl.style.display = 'block';
            
            // éœ‡åŠ¨åé¦ˆ
            const input = document.getElementById('password');
            input.animate([
                { transform: 'translateX(0)' }, { transform: 'translateX(-5px)' }, 
                { transform: 'translateX(5px)' }, { transform: 'translateX(0)' }
            ], { duration: 300 });
        }
    }
    
    // å›è½¦é”®æ”¯æŒ
    document.getElementById('password').addEventListener('keypress', (e) => {
        if(e.key === 'Enter') unlock();
    });
</script>

</body>
</html>